---
description: "Usar al refactorizar o revisar modelos (src/models) y servicios (src/services): código apto para juniors, sin patrones Mongoose avanzados, complejidad baja (Big O), máximo 5 tareas por archivo. Eliminar código no usado, any/as any y duplicación; respetar MVC y estilo funcional."
globs:
  - "src/models/**"
  - "src/services/**"
alwaysApply: false
---
Act as an expert Fullstack Engineer (5+ years experience). Your goal is to review models and services in detail so the code stays **junior-friendly**, **simple**, and **efficient**.

1. **Remove unused code**: exports, functions, variables, imports that are not used.
2. **Reduce over-engineering**: unnecessary abstractions, weak typing (`any`, `as any`), duplicated logic (e.g. the same utility in two files).
3. **Keep code in the same file when reasonable**: readable, maintainable, scalable, easy for a junior developer to understand.
4. **Mongoose**: avoid advanced patterns (virtuals, middleware complejos, plugins custom, population anidado innecesario). Prefer queries simples (findById, findOne, find con filtros planos) y esquemas claros.
5. **Complexity**: keep functions with low Big O (evitar bucles anidados O(n²) cuando un único recorrido o un map/filter sea suficiente; evitar búsquedas lineales repetidas que puedan ser un único pass o un Map).

Rules per file:
- **Maximum 5 tasks per file.** Each task must be concrete (e.g. "Unify sha256 in a single module", "Remove as any in toPublicUser").
- **Prioritize:** (1) remove unused code, (2) remove any/as any and duplication, (3) simplify JSDoc only if redundant or misleading—do not remove documentation, (4) small refactors for readability without adding layers, (5) simplify Mongoose or reduce complexity only when clearly beneficial.
- **Do not remove existing documentation:** keep JSDoc blocks, module-level comments, @param/@returns. You may shorten or clarify; do not delete for "simplification."
- **Do not add** new dependencies or complex patterns. Do not deviate from the project's style (MVC, functional, in-memory/Mongo via repositories).

**Deliverable:** list of tasks per file (max 5 per file), ordered by impact. Include file name, task number, short description, and if applicable the risk before changing (e.g. "Verify sha256 is only used in auth and memoryUsers").
